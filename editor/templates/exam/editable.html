{% extends "exam/edit.html" %}
{% load verbatim %}

{% block editable_message %}You can edit this question.{% endblock %}

{% block editor %}
	{{ block.super }}
	{% include "editable.html" %}

	<div class="tab-content">
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='general'}">
			<div class="row-fluid">
				<label>
					<h4>Exam Name</h4>
					<input class="input-block-level" id="exam-name" data-bind="value: name, valueUpdate: 'afterkeydown'" type="text"/>
				</label>
			</div>
			<div class="row-fluid">
				<form class="form-horizontal">
					<div class="control-group" data-bind="template: {
						name: 'selectproperty',
						data: {label: 'Theme:', property: theme, options: Editor.themes}
					}"></div>
					<div class="control-group" data-bind="visible: Editor.locales.length>1, template: {
						name: 'selectproperty',
						data: {label: 'Interface language:', property: locale, options: Editor.locales}
					}"></div>

					<div class="control-group" data-bind="template: {
						name: 'percentproperty',
						data: {label:'Pass threshold (percent):',property:percentPass}
					}"></div>
				</form>
			</div>
			<div class="row-fluid">
				<div class="span6">
					<label for="description"><h4>Description</h4></label>
					<div id="description" data-bind="writemaths: description"></div>
				</div>
				<div class="span6">
					<label for="authors-notes"><h4>Author's Notes</h4></label>
					<div id="authors-notes" data-bind="writemaths: notes"></div>
				</div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='navigation'}">
			<form class="form-horizontal">
				<div class="control-group" data-bind="template: {
					name: 'booleanproperty',
					data: {label:'Allow user to regenerate questions?', property:allowregen}
				}"></div>
				<div class="control-group" data-bind="template: {
					name: 'booleanproperty',
					data: {label:'Allow move to previous question?', property:reverse}
				}"></div>
				<div class="control-group" data-bind="template: {
					name: 'booleanproperty',
					data: {label:'Allow jump to any question?', property:browse}
				}"></div>
				<div class="control-group" data-bind="template: {
					name: 'booleanproperty',
					data: {label: 'Show front page?',property:showfrontpage}
				}"></div>
				<div class="control-group" data-bind="template: {
					name: 'booleanproperty',
					data: {label: 'Confirm before leaving the exam while it\'s running?',property:preventleave}
				}"></div>
				<div data-bind="template: {
					name: 'event',
					data: onleave
				}"></div>
			</form>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='timing'}">
			<form class="form-horizontal">
				<div class="control-group" data-bind="template: {
					name: 'numberproperty',
					data: {label:'Exam duration (minutes):',property:duration, type:'number',min:0}
				}"></div>
				<div data-bind="template: {
					name: 'event',
					data: timeout
				}"></div>
				<div data-bind="template: {
					name: 'event',
					data: timedwarning
				}"></div>
			</form>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='feedback'}">
			<form class="form-horizontal">
				<div class="control-group" data-bind="template: {
					name: 'booleanproperty',
					data: { label:'Show current score?', property:showactualmark}
				}"></div>
				<div class="control-group" data-bind="template: {
					name: 'booleanproperty',
					data: { label:'Show maximum score?', property:showtotalmark}
				}"></div>
				<div class="control-group" data-bind="template: {
					name: 'booleanproperty',
					data: { label:'Show answer state?', property:showanswerstate}
				}"></div>
				<div class="control-group" data-bind="template: {
					name: 'booleanproperty',
					data: { label:'Allow reveal answer?', property:allowrevealanswer}
				}"></div>
				<div class="control-group" data-bind="template: {
					name: 'percentproperty',
					data: { label:'Advice threshold (percent)', property:advicethreshold}
				}"></div>
			</form>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='questions'}">
			<div class="row-fluid">
			</div>
            <div class="questions row-fluid">
                <div class="span6">
                    <form class="form-horizontal">
                        <div class="control-group" data-bind="template: {
                            name: 'booleanproperty',
                            data: {label: 'Shuffle questions?',property:shuffleQuestions}
                        }"></div>
                    </form>
                    <ul class="questionList" data-bind="
                        sortable: {
                            template: 'question', 
                            data: questions, 
                            afterMove: dropQuestion,
                            options: {handle: '.handle', placeholder: 'placeholder'}
                        }
                        "></ul>
                </div>
                <div class="span6">
                    <form class="form-horizontal" data-bind="submit: search.submit">
                        <div class="control-group">
                            <label for="questionsearch">
                                <span class="control-label">Search for questions:</span>
                                <div class="controls">
                                    <div class="input-append">
                                        <input type="text" id="questionsearch" class="search" placeholder="Topic or question name" data-bind="
                                            value: search.query, 
                                            valueUpdate: 'afterkeydown'
                                        "/>
                                        <span class="add-on"><button type="submit" class="search" data-bind="css: {loading: searching}"></button></span>
                                    </div>
                                </div>
                            </label>
                            <label for="questionsearchtags">
                                <span class="control-label">Filter by tags:</span>
                                <div class="controls">
                                    <input type="text" id="questionsearchtags" class="search" placeholder="Tags separated by commas" data-bind="
                                        value: search.tags, 
                                        valueUpdate: 'afterkeydown'
                                    "/>
                                </div>
                            </label>
                        </div>
                    </form>
                    <div class="searchBox">
                        <ul class="results editlist big" data-bind="
                            template: {
                                name: 'questionResult',
                                foreach: search.results.all,
                            }
                        "></ul>
                    </div>
                </div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='access'}">
			<form class="form-horizontal">
				<div class="control-group">
					<label>
						<span class="control-label">Public visibility:</span>
						<div class="controls">
							<select data-bind="value: public_access, options: access_options, optionsText:'text',optionsValue:'value'"></select>
						</div>
					</label>
				</div>
			</form>
			<h4>Individual access rights</h4>
			<form class="form-horizontal" data-bind="submit: function(){}">
				<!-- ko foreach: {data: access_rights, afterAdd: Editor.afterAdd, beforeRemove: Editor.beforeRemove} -->
				<div class=control-group">
					<label>
						<span class="control-label" data-bind="text:name"></span>
						<div class="controls">
							<select data-bind="hasfocus: true, value: access_level, options: access_options, optionsText:'text',optionsValue:'value'"></select>
							<button type="button" class="delete" data-bind="click: remove" title="Remove this user's access"></button>
						</div>
					</label>
				</div>
				<!-- /ko -->
				<div class="control-group access-search">
					<label>
						<span class="control-label">Search for a user to give access to:</span>
						<div class="controls">
							<input id="search_author" type="text" size="30" data-bind="
								value: userAccessSearch,
								autocomplete: '{% url 'user_search' %}', 
								autocompleteCallback: function(user) { return {label: user.name, value: user.name} },
								autocompleteSelect: addUserAccess
								"/>
						</div>
					</label>
				</div>
			</form>
		</section>
	</div>

	{% verbatim %}

	<script type="text/html" id="event">
		<h4 data-bind="html:niceName"></h4>
		<div class="control-group">
			<label>
				<span class="control-label">Action:</span>
				<div class="controls">
					<select data-bind="options: actions, value: action, optionsText: 'niceName'"></select>
				</div>
			</label>
		</div>
		<div class="control-group">
			<label data-bind="fadeVisible:action().name!='none'">
				<span class="control-label">Message:</span>
				<div class="controls" data-bind="writemaths: message, wmHeight: 100, wmWidth: 500"/>
			</label>
		</div>
	</script>

	<script type="text/html" id="question">
		<li class="question clearAfter">
			<span class="handle"></span>
			<div class="controls">
				<a class="preview" data-bind="attr: {href: previewURL()}" target="_blank" title="Test run this question"></a>
				<button type="button" class="copy" data-bind="click:replaceWithCopy" title="Replace this question with a copy"></button>
				<button type="button" class="delete delete-grey" data-bind="click:remove" title="Delete this question"></button>
			</div>
			<div class="title">
				<span class="number" data-bind="text: ($index()+1)+'.'"/>
				<a data-bind="attr:{href: url}, text: name" target="_blank"></a>
			</div>
			<div class="description" data-bind="visible: description.length>0, html: description, mathjax: true"></div>
		</li>
	</script>

	<script type="text/html" id="questionResult">
		<li class="question questionResult">
			<span class="handle" data-bind="click: add"></span>
			<div class="controls">
				<a class="preview" data-bind="attr: {href: previewURL()}" target="_blank" title="Test run this question"></a>
			</div>
			<div class="title">
				<a data-bind="attr:{href: url}, text: name" target="_blank"></a>
			</div>
			<div class="author">
				(<span data-bind="text: author"></span>)
            </div>
            <div data-bind="attr: {class: 'progress-display '+progress}, text: progressDisplay"></div>
			<div class="description" data-bind="visible: description.length>0, html: description, mathjax: true"></div>
		</li>
	</script>
	{% endverbatim %}

{% endblock editor %}
